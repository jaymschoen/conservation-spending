<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Conservation funding does not track drivers of biodiversity loss</title>
  <meta name="description" content="Conservation funding does not track drivers of biodiversity loss" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Conservation funding does not track drivers of biodiversity loss" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Conservation funding does not track drivers of biodiversity loss" />
  <meta name="github-repo" content="vjjan91/conservation-spending" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Conservation funding does not track drivers of biodiversity loss" />
  
  <meta name="twitter:description" content="Conservation funding does not track drivers of biodiversity loss" />
  

<meta name="author" content="Vijay Ramesh1*, Jay Schoen1, Michael Levin1, Pratik Dubal2, Rochelle Thomas1, Sebastian Heilpern1, Jared Meek1, Pooja Choksi1, Don J Melnick1, Sara Kross1&quot;" />


<meta name="date" content="2020-09-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  

<link rel="next" href="figure-4-threats-network-analysis.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#attribution"><i class="fa fa-check"></i><b>1.1</b> Attribution</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data-access"><i class="fa fa-check"></i><b>1.2</b> Data access</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#data-processing"><i class="fa fa-check"></i><b>1.3</b> Data processing</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#affiliations"><i class="fa fa-check"></i><b>1.4</b> Affiliations</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#manuscript-figures"><i class="fa fa-check"></i><b>1.5</b> Manuscript Figures</a><ul>
<li class="chapter" data-level="1.5.1" data-path="index.html"><a href="index.html#figure-1-proportion-of-money-vs.-species-threatened"><i class="fa fa-check"></i><b>1.5.1</b> Figure 1: Proportion of Money vs. Species Threatened</a></li>
<li class="chapter" data-level="1.5.2" data-path="index.html"><a href="index.html#figure-2-amount-of-money-allocated-across-unique-threat-categories-per-year"><i class="fa fa-check"></i><b>1.5.2</b> Figure 2: Amount of Money Allocated Across Unique Threat Categories per Year</a></li>
<li class="chapter" data-level="1.5.3" data-path="index.html"><a href="index.html#figure-3-taxathreat-maxwell-comparison"><i class="fa fa-check"></i><b>1.5.3</b> Figure 3: Taxa/Threat Maxwell Comparison</a></li>
<li class="chapter" data-level="1.5.4" data-path="index.html"><a href="index.html#figure-4-network-analysis"><i class="fa fa-check"></i><b>1.5.4</b> Figure 4: Network Analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="figure-4-threats-network-analysis.html"><a href="figure-4-threats-network-analysis.html"><i class="fa fa-check"></i><b>2</b> Figure 4: Threats Network Analysis</a><ul>
<li class="chapter" data-level="2.1" data-path="figure-4-threats-network-analysis.html"><a href="figure-4-threats-network-analysis.html#threat-category-overlap"><i class="fa fa-check"></i><b>2.1</b> Threat Category Overlap</a></li>
<li class="chapter" data-level="2.2" data-path="figure-4-threats-network-analysis.html"><a href="figure-4-threats-network-analysis.html#pie-charts"><i class="fa fa-check"></i><b>2.2</b> Pie Charts</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Conservation funding does not track drivers of biodiversity loss</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">Conservation funding does not track drivers of biodiversity loss</h1>
<p class="author"><em>Vijay Ramesh<sup>1*</sup>, Jay Schoen<sup>1</sup>, Michael Levin<sup>1</sup>, Pratik Dubal<sup>2</sup>, Rochelle Thomas<sup>1</sup>, Sebastian Heilpern<sup>1</sup>, Jared Meek<sup>1</sup>, Pooja Choksi<sup>1</sup>, Don J Melnick<sup>1</sup>, Sara Kross<sup>1</sup>"</em></p>
<p class="date"><em>2020-09-17</em></p>
</div>
<div id="introduction" class="section level1">
<h1><span class="header-section-number">Section 1</span> Introduction</h1>
<p>This is the <code>bookdown</code> version of a repository that contains code and analyses associated with Ramesh et. al. (in review).</p>
<div id="attribution" class="section level2">
<h2><span class="header-section-number">1.1</span> Attribution</h2>
<p>Please contact the following in case of interest in the project.</p>
<ul>
<li>Vijay Ramesh (lead author)
<ul>
<li>PhD student, Columbia University</li>
</ul></li>
</ul>
</div>
<div id="data-access" class="section level2">
<h2><span class="header-section-number">1.2</span> Data access</h2>
<p>The following files are required to reproduce our analysis.</p>
<ul>
<li>all-grants.csv: A sheet containing all grant data.</li>
<li>list-of-preprocessing-phrases.csv: A sheet containing phrases which need to removed before classification.</li>
<li>list-of-keywords.csv: A sheet containing keywords which will be used to perform the rule-based classification.</li>
<li>list-of-stopwords.csv: A sheet containing stopwords, which need to be used to post-process and filter the classification results.</li>
</ul>
</div>
<div id="data-processing" class="section level2">
<h2><span class="header-section-number">1.3</span> Data processing</h2>
<p>The data processing for this project is described in the following sections. Navigate through them using the links in the sidebar.</p>
</div>
<div id="affiliations" class="section level2">
<h2><span class="header-section-number">1.4</span> Affiliations</h2>
<p><sup>1</sup>Department of Ecology, Evolution and Environmental Biology, Columbia University, 1200 Amsterdam Avenue, New York, NY 10027.</p>
<p><sup>2</sup>Department of Computer Science, Columbia University, New York, NY 10027.</p>
<p><sup>*</sup>Corresponding author. Email: <a href="mailto:vr2352@columbia.edu" class="email">vr2352@columbia.edu</a></p>

<div id="pre-processing-and-filtering-of-grants" class="section level4">
<h4><span class="header-section-number">1.4.0.1</span> Pre-processing and filtering of grants</h4>
<p>Here, we will filter our list our grants using our pre-processing phrases and use our list of keywords to carry out our rule-based classification</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1"><span class="im">import</span> re</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="im">import</span> csv</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="im">import</span> tqdm</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb1-6" title="6"></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw">def</span> string_found(string1, string2):</a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="cf">if</span> re.search(<span class="vs">r&quot;\b&quot;</span> <span class="op">+</span> re.escape(string1) <span class="op">+</span> <span class="vs">r&quot;\b&quot;</span>, string2):</a>
<a class="sourceLine" id="cb1-9" title="9">        <span class="cf">return</span> <span class="va">True</span></a>
<a class="sourceLine" id="cb1-10" title="10">    <span class="cf">return</span> <span class="va">False</span></a></code></pre></div>
<p>Preprocessing to remove grants which are empty, operating support, etc.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" title="1">data <span class="op">=</span> pd.read_csv(<span class="st">&#39;data</span><span class="ch">\\</span><span class="st">all-grants.csv&#39;</span>)</a>
<a class="sourceLine" id="cb2-2" title="2">preproc_ph <span class="op">=</span> pd.read_csv(<span class="st">&#39;data</span><span class="ch">\\</span><span class="st">list-of-preprocessing-phrases.csv&#39;</span>)</a>
<a class="sourceLine" id="cb2-3" title="3">preproc_phrases <span class="op">=</span> <span class="bu">list</span>(preproc_ph.Phrases)</a>
<a class="sourceLine" id="cb2-4" title="4">data <span class="op">=</span> data.drop([ele <span class="cf">for</span> ele <span class="kw">in</span> data.columns.to_list()</a>
<a class="sourceLine" id="cb2-5" title="5">                  <span class="cf">if</span> ele <span class="kw">not</span> <span class="kw">in</span> [<span class="st">&#39;Description&#39;</span>]], axis<span class="op">=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-6" title="6">data <span class="op">=</span> data.dropna().reset_index(drop<span class="op">=</span><span class="va">True</span>)</a>
<a class="sourceLine" id="cb2-7" title="7"></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="cf">for</span> phrase <span class="kw">in</span> preproc_phrases[:<span class="dv">6</span>]:</a>
<a class="sourceLine" id="cb2-9" title="9">    data <span class="op">=</span> data[<span class="op">~</span>data.Description.<span class="bu">str</span>.contains(phrase)]</a>
<a class="sourceLine" id="cb2-10" title="10"></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="cf">for</span> phrase <span class="kw">in</span> preproc_phrases[<span class="dv">6</span>:]:</a>
<a class="sourceLine" id="cb2-12" title="12">    data <span class="op">=</span> data[data.Description.<span class="bu">str</span>.lower() <span class="op">!=</span> phrase]</a>
<a class="sourceLine" id="cb2-13" title="13"></a>
<a class="sourceLine" id="cb2-14" title="14">data_sentences <span class="op">=</span> data.Description.values.tolist()</a>
<a class="sourceLine" id="cb2-15" title="15">data_sentences <span class="op">=</span> [x.lower() <span class="cf">for</span> x <span class="kw">in</span> data_sentences]</a>
<a class="sourceLine" id="cb2-16" title="16"></a>
<a class="sourceLine" id="cb2-17" title="17"><span class="co"># Bigrams/Keywords to be searched as substrings in description</span></a>
<a class="sourceLine" id="cb2-18" title="18">keywords_df <span class="op">=</span> pd.read_csv(<span class="st">&#39;~data/list-of-keywords.csv&#39;</span>)</a>
<a class="sourceLine" id="cb2-19" title="19">category_names <span class="op">=</span> [x.strip() <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">list</span>(keywords_df)]</a>
<a class="sourceLine" id="cb2-20" title="20">keywords <span class="op">=</span> []</a>
<a class="sourceLine" id="cb2-21" title="21"></a>
<a class="sourceLine" id="cb2-22" title="22"><span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(category_names)):</a>
<a class="sourceLine" id="cb2-23" title="23">    keywords.append(<span class="bu">list</span>(<span class="bu">set</span>(keywords_df[category_names[idx]].dropna())))</a>
<a class="sourceLine" id="cb2-24" title="24"></a>
<a class="sourceLine" id="cb2-25" title="25">grant_categories <span class="op">=</span> []</a>
<a class="sourceLine" id="cb2-26" title="26">grant_keywords <span class="op">=</span> []</a>
<a class="sourceLine" id="cb2-27" title="27"></a>
<a class="sourceLine" id="cb2-28" title="28">pbar <span class="op">=</span> tqdm.tqdm(total<span class="op">=</span><span class="bu">len</span>(data_sentences))</a>
<a class="sourceLine" id="cb2-29" title="29"><span class="cf">for</span> grant <span class="kw">in</span> data_sentences:</a>
<a class="sourceLine" id="cb2-30" title="30">    curr_cat <span class="op">=</span> []</a>
<a class="sourceLine" id="cb2-31" title="31">    curr_key <span class="op">=</span> []</a>
<a class="sourceLine" id="cb2-32" title="32">    <span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(category_names)):</a>
<a class="sourceLine" id="cb2-33" title="33">        <span class="cf">for</span> keyword <span class="kw">in</span> keywords[idx]:</a>
<a class="sourceLine" id="cb2-34" title="34">            <span class="cf">if</span> string_found(keyword, grant):</a>
<a class="sourceLine" id="cb2-35" title="35">                curr_key.append(keyword.replace(<span class="st">&#39; &#39;</span>, <span class="st">&#39;_&#39;</span>))</a>
<a class="sourceLine" id="cb2-36" title="36">                curr_cat.append(category_names[idx])</a>
<a class="sourceLine" id="cb2-37" title="37">    grant_categories.append(curr_cat)</a>
<a class="sourceLine" id="cb2-38" title="38">    grant_keywords.append(curr_key)</a>
<a class="sourceLine" id="cb2-39" title="39">    pbar.update(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-40" title="40">pbar.close()</a>
<a class="sourceLine" id="cb2-41" title="41"></a>
<a class="sourceLine" id="cb2-42" title="42"><span class="co"># Store description, keywords and categories as csv</span></a>
<a class="sourceLine" id="cb2-43" title="43">output_grants <span class="op">=</span> []</a>
<a class="sourceLine" id="cb2-44" title="44"></a>
<a class="sourceLine" id="cb2-45" title="45">pbar <span class="op">=</span> tqdm.tqdm(total<span class="op">=</span><span class="bu">len</span>(data_sentences))</a>
<a class="sourceLine" id="cb2-46" title="46"><span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data_sentences)):</a>
<a class="sourceLine" id="cb2-47" title="47">    temp <span class="op">=</span> []</a>
<a class="sourceLine" id="cb2-48" title="48">    temp.append(data_sentences[idx])</a>
<a class="sourceLine" id="cb2-49" title="49">    temp.append(<span class="st">&quot;|&quot;</span>.join(grant_keywords[idx]))</a>
<a class="sourceLine" id="cb2-50" title="50">    temp.append(<span class="st">&quot;|&quot;</span>.join(grant_categories[idx]))</a>
<a class="sourceLine" id="cb2-51" title="51">    output_grants.append(temp)</a>
<a class="sourceLine" id="cb2-52" title="52">    pbar.update(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-53" title="53">pbar.close()</a>
<a class="sourceLine" id="cb2-54" title="54"></a>
<a class="sourceLine" id="cb2-55" title="55"><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;data</span><span class="ch">\\</span><span class="st">output-grants.csv&quot;</span>, <span class="st">&quot;w&quot;</span>, newline<span class="op">=</span><span class="st">&quot;&quot;</span>) <span class="im">as</span> f:</a>
<a class="sourceLine" id="cb2-56" title="56">    writer <span class="op">=</span> csv.writer(f)</a>
<a class="sourceLine" id="cb2-57" title="57">    writer.writerow([<span class="st">&#39;Description&#39;</span>, <span class="st">&#39;Keywords&#39;</span>, <span class="st">&#39;Categories&#39;</span>])</a>
<a class="sourceLine" id="cb2-58" title="58">    writer.writerows(output_grants)</a></code></pre></div>

<p>Here, we will use a list of stopwords to further refine our output from our classification</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" title="1"><span class="im">import</span> re</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="im">import</span> csv</a>
<a class="sourceLine" id="cb3-3" title="3"><span class="im">import</span> tqdm</a>
<a class="sourceLine" id="cb3-4" title="4"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb3-5" title="5"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="kw">def</span> string_found(string1, string2):</a>
<a class="sourceLine" id="cb3-8" title="8">    <span class="cf">if</span> re.search(<span class="vs">r&quot;\b&quot;</span> <span class="op">+</span> re.escape(string1) <span class="op">+</span> <span class="vs">r&quot;\b&quot;</span>, string2):</a>
<a class="sourceLine" id="cb3-9" title="9">        <span class="cf">return</span> <span class="va">True</span></a>
<a class="sourceLine" id="cb3-10" title="10">    <span class="cf">return</span> <span class="va">False</span></a>
<a class="sourceLine" id="cb3-11" title="11"></a>
<a class="sourceLine" id="cb3-12" title="12">output_grants <span class="op">=</span> <span class="st">&#39;data</span><span class="ch">\\</span><span class="st">output-grants.csv&#39;</span></a>
<a class="sourceLine" id="cb3-13" title="13">stopwords_csv <span class="op">=</span> <span class="st">&#39;data</span><span class="ch">\\</span><span class="st">list-of-stopwords.csv&#39;</span></a>
<a class="sourceLine" id="cb3-14" title="14">output_filtered <span class="op">=</span> <span class="st">&#39;data</span><span class="ch">\\</span><span class="st">output-grants-filtered.csv.csv&#39;</span></a>
<a class="sourceLine" id="cb3-15" title="15"></a>
<a class="sourceLine" id="cb3-16" title="16">output_data <span class="op">=</span> pd.read_csv(output_grants)</a>
<a class="sourceLine" id="cb3-17" title="17">output_data[<span class="st">&#39;Stopwords&#39;</span>] <span class="op">=</span> <span class="st">&quot;-&quot;</span></a>
<a class="sourceLine" id="cb3-18" title="18">output_data[<span class="st">&#39;Filtered_Categories&#39;</span>] <span class="op">=</span> <span class="st">&quot;-&quot;</span></a>
<a class="sourceLine" id="cb3-19" title="19"></a>
<a class="sourceLine" id="cb3-20" title="20">stopwords_df <span class="op">=</span> pd.read_csv(stopwords_csv)</a>
<a class="sourceLine" id="cb3-21" title="21">stopwords_dict <span class="op">=</span> <span class="bu">dict</span>()</a>
<a class="sourceLine" id="cb3-22" title="22"><span class="cf">for</span> cat <span class="kw">in</span> [x.strip() <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">list</span>(stopwords_df)]:</a>
<a class="sourceLine" id="cb3-23" title="23">    temp <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(stopwords_df[cat].dropna()))</a>
<a class="sourceLine" id="cb3-24" title="24">    temp <span class="op">=</span> [x.lower() <span class="cf">for</span> x <span class="kw">in</span> temp]</a>
<a class="sourceLine" id="cb3-25" title="25">    stopwords_dict[cat] <span class="op">=</span> temp</a>
<a class="sourceLine" id="cb3-26" title="26">pbar <span class="op">=</span> tqdm.tqdm(total<span class="op">=</span><span class="bu">len</span>(output_data))</a>
<a class="sourceLine" id="cb3-27" title="27"></a>
<a class="sourceLine" id="cb3-28" title="28"><span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(output_data)):</a>
<a class="sourceLine" id="cb3-29" title="29">    class_cats <span class="op">=</span> <span class="bu">list</span>(output_data.iloc[idx][<span class="st">&#39;Categories&#39;</span>].split(<span class="st">&#39;|&#39;</span>))</a>
<a class="sourceLine" id="cb3-30" title="30">    stop_added <span class="op">=</span> []</a>
<a class="sourceLine" id="cb3-31" title="31">    flag <span class="op">=</span> <span class="va">False</span></a>
<a class="sourceLine" id="cb3-32" title="32"></a>
<a class="sourceLine" id="cb3-33" title="33">    <span class="cf">for</span> stop_cat <span class="kw">in</span> stopwords_dict.keys():</a>
<a class="sourceLine" id="cb3-34" title="34">        <span class="cf">if</span> stop_cat <span class="kw">in</span> class_cats:</a>
<a class="sourceLine" id="cb3-35" title="35">            <span class="cf">for</span> stopword <span class="kw">in</span> stopwords_dict[stop_cat]:</a>
<a class="sourceLine" id="cb3-36" title="36">                <span class="cf">if</span> string_found(stopword,</a>
<a class="sourceLine" id="cb3-37" title="37">                                output_data.iloc[idx][<span class="st">&#39;Description&#39;</span>].lower()):</a>
<a class="sourceLine" id="cb3-38" title="38">                    class_cats.remove(stop_cat)</a>
<a class="sourceLine" id="cb3-39" title="39">                    stop_added.append(stopword)</a>
<a class="sourceLine" id="cb3-40" title="40">                    <span class="cf">break</span></a>
<a class="sourceLine" id="cb3-41" title="41">    output_data.loc[idx,<span class="st">&#39;Filtered_Categories&#39;</span>] <span class="op">=</span> <span class="st">&#39;|&#39;</span>.join(<span class="bu">list</span>(<span class="bu">set</span>(class_cats)))</a>
<a class="sourceLine" id="cb3-42" title="42">    <span class="cf">if</span> <span class="bu">len</span>(stop_added) <span class="op">&gt;</span> <span class="dv">0</span>:</a>
<a class="sourceLine" id="cb3-43" title="43">        output_data.loc[idx, <span class="st">&#39;Stopwords&#39;</span>] <span class="op">=</span> <span class="st">&#39;|&#39;</span>.join(<span class="bu">list</span>(<span class="bu">set</span>(stop_added)))</a>
<a class="sourceLine" id="cb3-44" title="44">    pbar.update(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb3-45" title="45">pbar.close()</a>
<a class="sourceLine" id="cb3-46" title="46">output_data[output_data.Stopwords <span class="op">!=</span> <span class="st">&#39;-&#39;</span>]</a>
<a class="sourceLine" id="cb3-47" title="47">output_data.to_csv(output_filtered, index<span class="op">=</span><span class="va">False</span>)</a></code></pre></div>

</div>
<div id="preparing-a-final-datafame-for-analysis-of-threats-taxonomic-groups-and-proportion-of-funding" class="section level4">
<h4><span class="header-section-number">1.4.0.2</span> Preparing a final datafame for analysis of threats, taxonomic groups and proportion of funding</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" title="1"><span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="im">import</span> math</a>
<a class="sourceLine" id="cb4-4" title="4"><span class="im">import</span> tqdm</a>
<a class="sourceLine" id="cb4-5" title="5"></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MultiLabelBinarizer</a>
<a class="sourceLine" id="cb4-7" title="7">mlb <span class="op">=</span> MultiLabelBinarizer()</a>
<a class="sourceLine" id="cb4-8" title="8">data <span class="op">=</span> pd.read_csv(<span class="st">&#39;data</span><span class="ch">\\</span><span class="st">all-grants.csv&#39;</span>)</a>
<a class="sourceLine" id="cb4-9" title="9">preproc_ph <span class="op">=</span> pd.read_csv(<span class="st">&#39;data</span><span class="ch">\\</span><span class="st">list-of-preprocessing-phrases.csv&#39;</span>)</a>
<a class="sourceLine" id="cb4-10" title="10"></a>
<a class="sourceLine" id="cb4-11" title="11">preproc_phrases <span class="op">=</span> <span class="bu">list</span>(preproc_ph.Phrases)</a>
<a class="sourceLine" id="cb4-12" title="12">data <span class="op">=</span> data.drop([ele <span class="cf">for</span> ele <span class="kw">in</span> data.columns.to_list() <span class="cf">if</span> ele <span class="kw">in</span> [<span class="st">&#39;X&#39;</span>, <span class="st">&#39;Random Sort&#39;</span>, <span class="st">&#39;Unnamed: 0&#39;</span>]], axis<span class="op">=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-13" title="13">data <span class="op">=</span> data.dropna(subset<span class="op">=</span>[<span class="st">&#39;Description&#39;</span>])</a>
<a class="sourceLine" id="cb4-14" title="14"></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="cf">for</span> phrase <span class="kw">in</span> preproc_phrases[:<span class="dv">6</span>]:</a>
<a class="sourceLine" id="cb4-16" title="16">    data <span class="op">=</span> data[<span class="op">~</span>data.Description.<span class="bu">str</span>.contains(phrase)]</a>
<a class="sourceLine" id="cb4-17" title="17"></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="cf">for</span> phrase <span class="kw">in</span> preproc_phrases[<span class="dv">6</span>:]:</a>
<a class="sourceLine" id="cb4-19" title="19">    data <span class="op">=</span> data[data.Description.<span class="bu">str</span>.lower() <span class="op">!=</span> phrase]</a>
<a class="sourceLine" id="cb4-20" title="20"></a>
<a class="sourceLine" id="cb4-21" title="21">data <span class="op">=</span> data.reset_index(drop<span class="op">=</span><span class="va">True</span>)</a>
<a class="sourceLine" id="cb4-22" title="22">data_class <span class="op">=</span> pd.read_csv(<span class="st">&#39;data</span><span class="ch">\\</span><span class="st">output-grants-filtered.csv&#39;</span>)</a>
<a class="sourceLine" id="cb4-23" title="23">data_class <span class="op">=</span> data_class.fillna(<span class="st">&#39;-&#39;</span>)</a>
<a class="sourceLine" id="cb4-24" title="24"></a>
<a class="sourceLine" id="cb4-25" title="25">pbar <span class="op">=</span> tqdm.tqdm(total<span class="op">=</span><span class="bu">len</span>(data))</a>
<a class="sourceLine" id="cb4-26" title="26"><span class="cf">for</span> idx <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(data)):</a>
<a class="sourceLine" id="cb4-27" title="27">    <span class="cf">for</span> col <span class="kw">in</span> data_class.columns[<span class="dv">1</span>:]:</a>
<a class="sourceLine" id="cb4-28" title="28">        <span class="cf">if</span> <span class="bu">type</span>(data_class[col][idx]) <span class="op">==</span> <span class="bu">str</span>:</a>
<a class="sourceLine" id="cb4-29" title="29">            data_class[col][idx] <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(data_class[col][idx].split(<span class="st">&#39;|&#39;</span>)))</a>
<a class="sourceLine" id="cb4-30" title="30">    pbar.update(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-31" title="31">pbar.close()</a>
<a class="sourceLine" id="cb4-32" title="32">df_final <span class="op">=</span> pd.concat([data, data_class[[<span class="st">&#39;Keywords&#39;</span>, <span class="st">&#39;Filtered_Categories&#39;</span>,</a>
<a class="sourceLine" id="cb4-33" title="33">                                        <span class="st">&#39;Bio_keywords&#39;</span>]]],</a>
<a class="sourceLine" id="cb4-34" title="34">                     axis<span class="op">=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-35" title="35">df_final <span class="op">=</span> df_final.join(pd.DataFrame(mlb.fit_transform(df_final.pop(<span class="st">&#39;Filtered_Categories&#39;</span>)),columns<span class="op">=</span>[<span class="st">&#39;cat_&#39;</span> <span class="op">+</span> x <span class="cf">for</span> x <span class="kw">in</span> mlb.classes_],index<span class="op">=</span>df_final.index))</a>
<a class="sourceLine" id="cb4-36" title="36">df_final <span class="op">=</span> df_final.join(pd.DataFrame(mlb.fit_transform(df_final.pop(<span class="st">&#39;Bio_keywords&#39;</span>)),columns<span class="op">=</span>[<span class="st">&#39;bio_key_&#39;</span> <span class="op">+</span> x <span class="cf">for</span> x <span class="kw">in</span> mlb.classes_],index<span class="op">=</span>df_final.index))</a>
<a class="sourceLine" id="cb4-37" title="37"></a>
<a class="sourceLine" id="cb4-38" title="38">df_final <span class="op">=</span> df_final.drop([<span class="st">&#39;cat_-&#39;</span>, <span class="st">&#39;bio_key_-&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-39" title="39">df_final.to_csv(<span class="st">&#39;data</span><span class="ch">\\</span><span class="st">classified-grants-for-analysis.csv&#39;</span>, index<span class="op">=</span><span class="va">False</span>)</a></code></pre></div>

</div>
<div id="post-processing-of-grants-following-validation" class="section level4">
<h4><span class="header-section-number">1.4.0.3</span> Post-processing of grants following validation</h4>
<p>Here we remove and filter those grants that may have been erroneously classified, following the process of validation</p>
<p>Here we hard-coded several specific fixes to the classification that repeatedly cropped up during our validation process. All have been checked to have 0 mis-classifications.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># Removing grants containing &quot;dinner&quot;</span></a>
<a class="sourceLine" id="cb5-2" title="2">dat &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(Description, <span class="st">&quot;dinner&quot;</span>) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-4" title="4"></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co"># Classifying &quot;dissemination&quot; as act_edu</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="kw">sum</span>(dat<span class="op">$</span>cat_act_edu)</a>
<a class="sourceLine" id="cb5-7" title="7"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(dat)) {</a>
<a class="sourceLine" id="cb5-8" title="8">  <span class="cf">if</span>(<span class="kw">str_detect</span>(dat<span class="op">$</span>Description[i], <span class="st">&quot;dissemination&quot;</span>) <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb5-9" title="9">    dat<span class="op">$</span>cat_act_edu[i] =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb5-10" title="10">  }</a>
<a class="sourceLine" id="cb5-11" title="11">}</a>
<a class="sourceLine" id="cb5-12" title="12"><span class="kw">sum</span>(dat<span class="op">$</span>cat_act_edu)</a>
<a class="sourceLine" id="cb5-13" title="13"></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="co"># Removing threat_energytransport classification for &quot;palm oil&quot;</span></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="kw">sum</span>(dat<span class="op">$</span>cat_threat_energytransport)</a>
<a class="sourceLine" id="cb5-16" title="16"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(dat)) {</a>
<a class="sourceLine" id="cb5-17" title="17">  <span class="cf">if</span>(<span class="kw">str_detect</span>(dat<span class="op">$</span>Description[i], <span class="st">&quot;palm oil|oil-palm|oil palm&quot;</span>) <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb5-18" title="18">    dat<span class="op">$</span>cat_threat_energytransport[i] =<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb5-19" title="19">  }</a>
<a class="sourceLine" id="cb5-20" title="20">}</a>
<a class="sourceLine" id="cb5-21" title="21"><span class="kw">sum</span>(dat<span class="op">$</span>cat_threat_energytransport)</a>
<a class="sourceLine" id="cb5-22" title="22"></a>
<a class="sourceLine" id="cb5-23" title="23"><span class="co"># Removing hab_other classification for &quot;aquatic&quot; (will be freshwater/marine)</span></a>
<a class="sourceLine" id="cb5-24" title="24"><span class="kw">sum</span>(dat<span class="op">$</span>cat_habitat_other)</a>
<a class="sourceLine" id="cb5-25" title="25"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(dat)) {</a>
<a class="sourceLine" id="cb5-26" title="26">  <span class="cf">if</span>(<span class="kw">str_detect</span>(dat<span class="op">$</span>Description[i], <span class="st">&quot;aquatic&quot;</span>) <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb5-27" title="27">    dat<span class="op">$</span>cat_habitat_other[i] =<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb5-28" title="28">  }</a>
<a class="sourceLine" id="cb5-29" title="29">}</a>
<a class="sourceLine" id="cb5-30" title="30"><span class="kw">sum</span>(dat<span class="op">$</span>cat_habitat_other)</a></code></pre></div>
<p>Those grants with no funding amount recorded contributed nothing to this analysis, and were removed.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">dat<span class="fl">.1</span> &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="st">  </span><span class="kw">drop_na</span>(Grant.Amount) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">42</span>) </a>
<a class="sourceLine" id="cb6-4" title="4"><span class="kw">names</span>(dat<span class="fl">.1</span>)</a></code></pre></div>
<p>We ensured that our study focused on in situ conservation grants by eliminating grants that were directed toward captive management (aquarium/zoo category)</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(dat<span class="fl">.1</span>)){</a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="cf">if</span>(dat<span class="fl">.1</span><span class="op">$</span>cat_aquarium_zoo[i]<span class="op">==</span><span class="dv">1</span>){</a>
<a class="sourceLine" id="cb7-3" title="3">    dat<span class="fl">.1</span>[i,<span class="kw">c</span>(<span class="dv">11</span><span class="op">:</span><span class="dv">17</span>, <span class="dv">19</span><span class="op">:</span><span class="dv">28</span>, <span class="dv">30</span><span class="op">:</span><span class="dv">42</span>)]=<span class="dv">0</span></a>
<a class="sourceLine" id="cb7-4" title="4">  }</a>
<a class="sourceLine" id="cb7-5" title="5">}</a>
<a class="sourceLine" id="cb7-6" title="6"></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="kw">write_csv</span>(dat,<span class="st">&quot;data</span><span class="ch">\\</span><span class="st">post-processed-grants-for-analysis.csv&quot;</span>)</a></code></pre></div>

<p>Here, we will carry out exploratory data analysis of grants to obtain a sense of how money has been allocated across threat and taxonomic groups.</p>
<ol style="list-style-type: decimal">
<li>Dealing with grants that were classified into multiple categories</li>
</ol>
<p>The code below governs the way we dealt with multiple, potentially overlapping categories on individual grants. The general format is as follows:</p>
<ul>
<li>If a grant description had two keyword matches with two sub-categories of the same category (e.g. threat_climate &amp; threat_energytransport), it was classified into a joint sub-category (threat_climate_energytransport).</li>
<li>Grants that were classified into three or more sub-categories within a category (e.g. threat_climate &amp; threat_energytransport &amp; threat_pollution) were classified into a sub-category labeled as “other” (e.g. threat_other).</li>
</ul>
<p>Read in the post-processed grants for analysis</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">dat<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;data</span><span class="ch">\\</span><span class="st">post-processed-grants-for-analysis.csv&#39;</span>)</a></code></pre></div>
<p>Here, we built dummy variables that take the sum of our binary classification data across the columns of each broader category.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">dat<span class="fl">.1</span> &lt;-<span class="st"> </span>dat<span class="fl">.1</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Num.Class =</span> <span class="kw">rowSums</span>(.[,<span class="dv">11</span><span class="op">:</span><span class="kw">length</span>(.)])) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Num.Thr =</span> <span class="kw">rowSums</span>(.[<span class="dv">37</span><span class="op">:</span><span class="dv">42</span>])) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Num.Act =</span> <span class="kw">rowSums</span>(.[<span class="dv">11</span><span class="op">:</span><span class="dv">17</span>])) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Num.Hab =</span> <span class="kw">rowSums</span>(.[<span class="kw">c</span>(<span class="dv">25</span>,<span class="dv">26</span>,<span class="dv">28</span>)])) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Num.Tax =</span> <span class="kw">rowSums</span>(.[<span class="dv">30</span><span class="op">:</span><span class="dv">36</span>])) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Num.Bio =</span> <span class="kw">rowSums</span>(.[<span class="dv">19</span><span class="op">:</span><span class="dv">20</span>]))</a></code></pre></div>
<p>Multiple threat categories</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">threat &lt;-<span class="st"> </span>dat<span class="fl">.1</span>[,<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">37</span><span class="op">:</span><span class="dv">42</span>)]</a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3">threat &lt;-<span class="st"> </span>threat <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sumAcross =</span> cat_threat_climate <span class="op">+</span><span class="st"> </span>cat_threat_energytransport <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="st">           </span>cat_threat_habitat <span class="op">+</span><span class="st"> </span>cat_threat_inv_spec <span class="op">+</span><span class="st"> </span>cat_threat_overexp <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="st">           </span>cat_threat_pollution) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="st">  </span><span class="kw">filter</span>(sumAcross <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb10-8" title="8"></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="co"># Checking number of grants/money for multiple threat category grants</span></a>
<a class="sourceLine" id="cb10-10" title="10">tot_threat &lt;-<span class="st"> </span><span class="kw">sum</span>(threat<span class="op">$</span>Grant.Amount, <span class="dt">na.rm =</span> T) </a>
<a class="sourceLine" id="cb10-11" title="11"></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="co"># Four or more threats retained all grants</span></a>
<a class="sourceLine" id="cb10-13" title="13">threat4 &lt;-<span class="st"> </span>threat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-14" title="14"><span class="st">  </span><span class="kw">filter</span>(sumAcross <span class="op">&lt;=</span><span class="st"> </span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb10-15" title="15"><span class="kw">nrow</span>(threat4)<span class="op">/</span><span class="kw">nrow</span>(threat)</a>
<a class="sourceLine" id="cb10-16" title="16"><span class="kw">sum</span>(threat4<span class="op">$</span>Grant.Amount,<span class="dt">na.rm =</span> T)<span class="op">/</span>tot_threat</a>
<a class="sourceLine" id="cb10-17" title="17"></a>
<a class="sourceLine" id="cb10-18" title="18"></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="co"># Three threats retains 99.3% of the money</span></a>
<a class="sourceLine" id="cb10-20" title="20">threat3 &lt;-<span class="st"> </span>threat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-21" title="21"><span class="st">  </span><span class="kw">filter</span>(sumAcross <span class="op">&lt;=</span><span class="st"> </span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb10-22" title="22"><span class="kw">nrow</span>(threat3)<span class="op">/</span><span class="kw">nrow</span>(threat)</a>
<a class="sourceLine" id="cb10-23" title="23"><span class="kw">sum</span>(threat3<span class="op">$</span>Grant.Amount,<span class="dt">na.rm =</span> T)<span class="op">/</span>tot_threat</a>
<a class="sourceLine" id="cb10-24" title="24"></a>
<a class="sourceLine" id="cb10-25" title="25"><span class="co"># Two threats retained 96% of the money</span></a>
<a class="sourceLine" id="cb10-26" title="26">threat2 &lt;-<span class="st"> </span>threat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-27" title="27"><span class="st">  </span><span class="kw">filter</span>(sumAcross <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb10-28" title="28"><span class="kw">nrow</span>(threat2)<span class="op">/</span><span class="kw">nrow</span>(threat)</a>
<a class="sourceLine" id="cb10-29" title="29"><span class="kw">sum</span>(threat2<span class="op">$</span>Grant.Amount, <span class="dt">na.rm =</span> T)<span class="op">/</span>tot_threat</a>
<a class="sourceLine" id="cb10-30" title="30"></a>
<a class="sourceLine" id="cb10-31" title="31"><span class="co"># Unique threat categories retained 80.3% of the money</span></a>
<a class="sourceLine" id="cb10-32" title="32">threat1 &lt;-<span class="st"> </span>threat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-33" title="33"><span class="st">  </span><span class="kw">filter</span>(sumAcross <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb10-34" title="34"><span class="kw">nrow</span>(threat1)<span class="op">/</span><span class="kw">nrow</span>(threat)</a>
<a class="sourceLine" id="cb10-35" title="35"><span class="kw">sum</span>(threat1<span class="op">$</span>Grant.Amount,<span class="dt">na.rm =</span> T)<span class="op">/</span>tot_threat</a></code></pre></div>
<p>Plot multiple threat categories and grants</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">n_threats &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span></a>
<a class="sourceLine" id="cb11-2" title="2">n_threat_grants &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">nrow</span>(threat1), </a>
<a class="sourceLine" id="cb11-3" title="3">                  <span class="kw">nrow</span>(threat2) <span class="op">-</span><span class="st"> </span><span class="kw">nrow</span>(threat1), </a>
<a class="sourceLine" id="cb11-4" title="4">                  <span class="kw">nrow</span>(threat3) <span class="op">-</span><span class="st"> </span><span class="kw">nrow</span>(threat2),</a>
<a class="sourceLine" id="cb11-5" title="5">                  <span class="kw">nrow</span>(threat4) <span class="op">-</span><span class="st"> </span><span class="kw">nrow</span>(threat3))</a>
<a class="sourceLine" id="cb11-6" title="6"></a>
<a class="sourceLine" id="cb11-7" title="7">threats &lt;-<span class="st"> </span><span class="kw">data.frame</span>(n_threats, n_threat_grants)</a>
<a class="sourceLine" id="cb11-8" title="8"></a>
<a class="sourceLine" id="cb11-9" title="9">fig_threats_grants &lt;-<span class="st"> </span><span class="kw">ggplot</span>(threats, <span class="kw">aes</span>(<span class="dt">x =</span> n_threats, <span class="dt">y =</span> n_threat_grants)) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Number of grants across multiple Threat Categories&quot;</span>,</a>
<a class="sourceLine" id="cb11-12" title="12">       <span class="dt">x=</span><span class="st">&quot;Number of threat categories&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Number of grants&quot;</span>)</a>
<a class="sourceLine" id="cb11-13" title="13"></a>
<a class="sourceLine" id="cb11-14" title="14"><span class="co"># save as png</span></a>
<a class="sourceLine" id="cb11-15" title="15"><span class="kw">ggsave</span>(fig_threats_grants, <span class="dt">filename =</span> <span class="st">&quot;figs/fig_threats_grants.png&quot;</span>, </a>
<a class="sourceLine" id="cb11-16" title="16">       <span class="dt">height =</span> <span class="dv">4</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">device =</span> <span class="kw">png</span>(), <span class="dt">dpi =</span> <span class="dv">300</span>); <span class="kw">dev.off</span>()</a></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="co"># show exported image</span></a>
<a class="sourceLine" id="cb12-2" title="2">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;figs/fig_threats_grants.png&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figs/fig_threats_grants.png" alt="Number of grants that were classified into one or more categories of threat" width="\textwidth" />
<p class="caption">
(#fig:export_fig_threats_grants)Number of grants that were classified into one or more categories of threat
</p>
</div>
<p>Following the above analysis, we decided to retain grants classified across multiple threat categories for the network analysis.</p>
<p>Below we visualize overall funding provided by the top 1000 grantmakers (Supplementary Fig S1 - Accumulation of Funding Across Top Grantmakers)</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="co"># Create donor ranks</span></a>
<a class="sourceLine" id="cb13-2" title="2">donor_Rank &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;Top 50&quot;</span>, <span class="st">&quot;Top 100&quot;</span>, <span class="st">&quot;Top 200&quot;</span>, <span class="st">&quot;Top 300&quot;</span>, <span class="st">&quot;Top 400&quot;</span>, <span class="st">&quot;Top 500&quot;</span>, <span class="st">&quot;Top 600&quot;</span>, <span class="st">&quot;Top 700&quot;</span>, <span class="st">&quot;Top 800&quot;</span>, <span class="st">&quot;Top 900&quot;</span>, <span class="st">&quot;Top 1000&quot;</span>)</a>
<a class="sourceLine" id="cb13-3" title="3"></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="co"># The values below were calculated by summing funding for each of the above donor ranks</span></a>
<a class="sourceLine" id="cb13-5" title="5">sum &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">14396513202</span>, <span class="dv">16440571398</span>, <span class="dv">18171144637</span>, <span class="dv">18975986509</span>, <span class="dv">19490663536</span>, <span class="dv">19851261916</span>, <span class="dv">20128241008</span>, <span class="dv">20348022885</span>, <span class="dv">20525790876</span>, <span class="dv">20670921174</span>, <span class="dv">20793224389</span>)</a>
<a class="sourceLine" id="cb13-6" title="6">sum_mildiv &lt;-<span class="st"> </span>sum<span class="op">/</span><span class="dv">1000000</span></a>
<a class="sourceLine" id="cb13-7" title="7">axis_Order &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>)</a>
<a class="sourceLine" id="cb13-8" title="8"></a>
<a class="sourceLine" id="cb13-9" title="9">sum.data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(donor_Rank, sum, sum_mildiv, axis_Order)</a>
<a class="sourceLine" id="cb13-10" title="10"></a>
<a class="sourceLine" id="cb13-11" title="11">fig_topGrantmakers_funding &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> sum.data,</a>
<a class="sourceLine" id="cb13-12" title="12">                    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> axis_Order,</a>
<a class="sourceLine" id="cb13-13" title="13">                                  <span class="dt">y =</span>  sum_mildiv,</a>
<a class="sourceLine" id="cb13-14" title="14">                                  <span class="dt">group =</span> <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb13-15" title="15"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb13-16" title="16"><span class="st">  </span><span class="kw">geom_area</span>(<span class="kw">aes</span>(<span class="dt">y=</span><span class="kw">ifelse</span>(sum_mildiv<span class="op">&gt;=</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>sum_mildiv<span class="op">&lt;</span><span class="st"> </span><span class="fl">19851.26</span>, sum_mildiv, <span class="fl">19851.26</span>)), <span class="dt">fill=</span><span class="st">&quot;#696969&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-17" title="17"><span class="st">  </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">21500</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-18" title="18"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb13-19" title="19"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Grantmaker Group&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-20" title="20"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Sum ($1,000,000USD)&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-21" title="21"><span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;Top 50&quot;</span>, <span class="st">&quot;Top 100&quot;</span>, <span class="st">&quot;Top 200&quot;</span>, <span class="st">&quot;Top 300&quot;</span>, <span class="st">&quot;Top 400&quot;</span>, <span class="st">&quot;Top 500&quot;</span>, <span class="st">&quot;Top 600&quot;</span>, <span class="st">&quot;Top 700&quot;</span>, <span class="st">&quot;Top 800&quot;</span>, <span class="st">&quot;Top 900&quot;</span>, <span class="st">&quot;Top 1000&quot;</span>))</a>
<a class="sourceLine" id="cb13-22" title="22"></a>
<a class="sourceLine" id="cb13-23" title="23"><span class="co"># save as png</span></a>
<a class="sourceLine" id="cb13-24" title="24"><span class="kw">ggsave</span>(fig_topGrantmakers_funding, <span class="dt">filename =</span> <span class="st">&quot;figs/fig_topGrantmakers_funding.png&quot;</span>, </a>
<a class="sourceLine" id="cb13-25" title="25">       <span class="dt">height =</span> <span class="dv">4</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">device =</span> <span class="kw">png</span>(), <span class="dt">dpi =</span> <span class="dv">300</span>); <span class="kw">dev.off</span>()</a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co"># show exported image</span></a>
<a class="sourceLine" id="cb14-2" title="2">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;figs/fig_topGrantmakers_funding.png&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figs/fig_topGrantmakers_funding.png" alt="Accumulation curve of the funding in our dataset across the top 1000 grantmakers. The shaded region encompasses the amount of funding captured by the top 500 grantmakers, which represents more than 95% of the total amount of funding." width="\textwidth" />
<p class="caption">
(#fig:export_fig_topGrantmakers_funding)Accumulation curve of the funding in our dataset across the top 1000 grantmakers. The shaded region encompasses the amount of funding captured by the top 500 grantmakers, which represents more than 95% of the total amount of funding.
</p>
</div>

<p>Threat-mismatch calculations: We estimate if the amount of funding to drivers of biodiversity loss tracks the number of species threatened by each of these drivers</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="co"># Load libraries</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb15-3" title="3"><span class="kw">library</span>(scales)</a>
<a class="sourceLine" id="cb15-4" title="4"><span class="kw">library</span>(ggsci)</a></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="co"># Read in data of post-processed grants</span></a>
<a class="sourceLine" id="cb16-2" title="2">data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data</span><span class="ch">\\</span><span class="st">post-processed-grants-for-analysis.csv&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="st">   </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="st">   </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">42</span>, <span class="dv">49</span><span class="op">:</span><span class="dv">109</span>, <span class="dv">43</span><span class="op">:</span><span class="dv">48</span>))</a>
<a class="sourceLine" id="cb16-5" title="5"></a>
<a class="sourceLine" id="cb16-6" title="6"><span class="co"># data.multi &lt;- read_csv(&quot;~/Desktop/master_output_data_analysis_v15_mutlicategories.csv&quot;) %&gt;% as.data.frame()</span></a>
<a class="sourceLine" id="cb16-7" title="7"></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="co"># Read in data on the number of species threatened (Maxwell et al. 2016)</span></a>
<a class="sourceLine" id="cb16-9" title="9">maxwell &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data</span><span class="ch">\\</span><span class="st">2016-maxwell et al-Table S2.csv&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-10" title="10"><span class="st">  </span><span class="kw">as.data.frame</span>()</a></code></pre></div>
</div>
</div>
<div id="manuscript-figures" class="section level2">
<h2><span class="header-section-number">1.5</span> Manuscript Figures</h2>
<div id="figure-1-proportion-of-money-vs.-species-threatened" class="section level3">
<h3><span class="header-section-number">1.5.1</span> Figure 1: Proportion of Money vs. Species Threatened</h3>
<p><strong>INSERT FIGURE CAPTION FROM MANUSCRIPT</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">fig.<span class="fl">1.</span>money_bio &lt;-<span class="st"> </span>by.year.money_bio <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-2" title="2"><span class="st">  </span><span class="kw">filter</span>(Category <span class="op">%in%</span><span class="st"> </span>u.threat_cat) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(Category) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Total =</span> <span class="kw">sum</span>(Amount))</a>
<a class="sourceLine" id="cb17-5" title="5"></a>
<a class="sourceLine" id="cb17-6" title="6">fig.<span class="fl">1.</span>species &lt;-<span class="st"> </span>maxwell <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-7" title="7"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(Category, n_species_threatened) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="st">  </span><span class="kw">group_by</span>(Category) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-9" title="9"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Total =</span> <span class="kw">sum</span>(n_species_threatened)) </a>
<a class="sourceLine" id="cb17-10" title="10"></a>
<a class="sourceLine" id="cb17-11" title="11">rawFrame &lt;-<span class="st"> </span><span class="kw">left_join</span>(fig.<span class="fl">1.</span>money_bio, fig.<span class="fl">1.</span>species, <span class="dt">by =</span> <span class="st">&quot;Category&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-12" title="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rawMoney =</span> Total.x) <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># Total Money</span></a>
<a class="sourceLine" id="cb17-13" title="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rawSpecies =</span> Total.y) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Total Species</span></a>
<a class="sourceLine" id="cb17-14" title="14"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(Category, rawMoney, rawSpecies)</a>
<a class="sourceLine" id="cb17-15" title="15"></a>
<a class="sourceLine" id="cb17-16" title="16">fig.<span class="fl">1.</span>data_bio &lt;-<span class="st"> </span><span class="kw">left_join</span>(fig.<span class="fl">1.</span>money_bio, fig.<span class="fl">1.</span>species, <span class="dt">by =</span> <span class="st">&quot;Category&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-17" title="17"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Money =</span> (Total.x<span class="op">/</span><span class="kw">sum</span>(Total.x))<span class="op">*</span><span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># Percentage of Total Money</span></a>
<a class="sourceLine" id="cb17-18" title="18"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Species =</span> (Total.y<span class="op">/</span><span class="kw">sum</span>(Total.y))<span class="op">*</span><span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Percentage of Total Species</span></a>
<a class="sourceLine" id="cb17-19" title="19"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(Category, Money, Species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-20" title="20"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">c</span>(Money, Species), <span class="dt">names_to =</span> <span class="st">&quot;is.Money&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;Amount&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-21" title="21"><span class="st">  </span><span class="kw">left_join</span>(rawFrame, <span class="dt">by =</span> <span class="st">&quot;Category&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-22" title="22"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rawMoney =</span> <span class="kw">ifelse</span>(is.Money <span class="op">==</span><span class="st"> &quot;Species&quot;</span>, <span class="ot">NA</span>, rawMoney)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-23" title="23"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rawSpecies=</span> <span class="kw">ifelse</span>(is.Money <span class="op">==</span><span class="st"> &quot;Money&quot;</span>, <span class="ot">NA</span>, rawSpecies)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-24" title="24"><span class="st">  </span><span class="kw">replace_na</span>(<span class="kw">list</span>(<span class="dt">rawMoney =</span> <span class="st">&quot;&quot;</span>, <span class="dt">rawSpecies =</span> <span class="st">&quot;&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-25" title="25"><span class="st">  </span><span class="kw">unite</span>(<span class="st">&quot;rawValue&quot;</span>, rawMoney<span class="op">:</span>rawSpecies, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>, <span class="dt">remove =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-26" title="26"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rawValue =</span> <span class="kw">as.numeric</span>(rawValue),</a>
<a class="sourceLine" id="cb17-27" title="27">         <span class="dt">rawLabels =</span> <span class="kw">comma</span>(rawValue))</a>
<a class="sourceLine" id="cb17-28" title="28">fig.<span class="fl">1.</span>data_bio<span class="op">$</span>rawLabels[<span class="kw">c</span>(<span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">11</span>,<span class="dv">2</span>))] &lt;-<span class="st"> </span><span class="kw">str_glue</span>(<span class="st">&quot;${round(rawFrame$rawMoney/1e6)}m&quot;</span>)</a>
<a class="sourceLine" id="cb17-29" title="29"><span class="co"># fig.1.data_bio$rawLabels[c(seq(2,12,2))] &lt;- rawFrame$rawSpecies</span></a>
<a class="sourceLine" id="cb17-30" title="30"></a>
<a class="sourceLine" id="cb17-31" title="31">fig.<span class="fl">1.</span>plot_bio &lt;-<span class="st"> </span><span class="kw">ggplot</span>(fig.<span class="fl">1.</span>data_bio, </a>
<a class="sourceLine" id="cb17-32" title="32">                      <span class="kw">aes</span>(<span class="dt">fill=</span>is.Money, </a>
<a class="sourceLine" id="cb17-33" title="33">                          <span class="dt">y=</span>Amount, </a>
<a class="sourceLine" id="cb17-34" title="34">                          <span class="dt">x=</span>Category)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-35" title="35"><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-36" title="36"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Threat Category&quot;</span>, </a>
<a class="sourceLine" id="cb17-37" title="37">       <span class="dt">y=</span><span class="st">&quot;Percentage&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-38" title="38"><span class="st">       </span><span class="co"># title=&quot;% Money Allocated vs. % Species Threatened (IUCN) by Unique Threats&quot;) +</span></a>
<a class="sourceLine" id="cb17-39" title="39"><span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">labels=</span>u.threat_list) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-40" title="40"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="co"># values = c(&quot;#556B2F&quot;, &quot;#8f3c36&quot;),</span></a>
<a class="sourceLine" id="cb17-41" title="41">                    <span class="dt">values =</span> <span class="kw">alpha</span>(<span class="kw">c</span>(<span class="st">&quot;darkgreen&quot;</span>, <span class="st">&quot;orangered4&quot;</span>), <span class="fl">0.9</span>),</a>
<a class="sourceLine" id="cb17-42" title="42">                    <span class="co"># values = c(&quot;#556B2F&quot;, &quot;#708090&quot;),</span></a>
<a class="sourceLine" id="cb17-43" title="43">                    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Money ($USD Million)&quot;</span>, <span class="st">&quot;# Threatened Species&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-44" title="44"><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width=</span> <span class="dv">1</span>), </a>
<a class="sourceLine" id="cb17-45" title="45">            <span class="kw">aes</span>(<span class="dt">label =</span> rawLabels, <span class="dt">hjust =</span> <span class="fl">0.5</span>, <span class="dt">vjust =</span> <span class="fl">-0.5</span>), <span class="dt">angle=</span><span class="dv">0</span>, <span class="dt">size=</span><span class="dv">6</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-46" title="46"><span class="st">  </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">50</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-47" title="47"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb17-48" title="48"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">16</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>), </a>
<a class="sourceLine" id="cb17-49" title="49">        <span class="dt">axis.ticks.length.x =</span> <span class="kw">unit</span>(.<span class="dv">5</span>, <span class="st">&quot;cm&quot;</span>),</a>
<a class="sourceLine" id="cb17-50" title="50">        <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">14</span>),</a>
<a class="sourceLine" id="cb17-51" title="51">        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb17-52" title="52">        <span class="dt">legend.key.size =</span> <span class="kw">unit</span>(<span class="dv">1</span>,<span class="st">&quot;cm&quot;</span>),</a>
<a class="sourceLine" id="cb17-53" title="53">        <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>))</a>
<a class="sourceLine" id="cb17-54" title="54"></a>
<a class="sourceLine" id="cb17-55" title="55"><span class="co"># ggsave(fig.1.plot_bio, filename = &quot;~/Columbia E3B/Conservation Group/Output V15.2/Figures/money_species_comparison.png&quot;, width=15, height=7,dpi = 300)</span></a>
<a class="sourceLine" id="cb17-56" title="56"></a>
<a class="sourceLine" id="cb17-57" title="57">fig.<span class="fl">1.</span>plot_bio</a></code></pre></div>

</div>
<div id="figure-2-amount-of-money-allocated-across-unique-threat-categories-per-year" class="section level3">
<h3><span class="header-section-number">1.5.2</span> Figure 2: Amount of Money Allocated Across Unique Threat Categories per Year</h3>
<p><strong>INSERT FIGURE CAPTION FROM MANUSCRIPT</strong></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">threat_temporal.data &lt;-<span class="st"> </span>by.year.money_bio <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-2" title="2"><span class="st">  </span><span class="kw">filter</span>(Category <span class="op">%in%</span><span class="st"> </span>u.threat_cat)</a>
<a class="sourceLine" id="cb18-3" title="3"></a>
<a class="sourceLine" id="cb18-4" title="4">threat_temporal.plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(threat_temporal.data, </a>
<a class="sourceLine" id="cb18-5" title="5">                <span class="kw">aes</span>(<span class="dt">y =</span> Amount, </a>
<a class="sourceLine" id="cb18-6" title="6">                    <span class="dt">x =</span> Year.Authorized,</a>
<a class="sourceLine" id="cb18-7" title="7">                    <span class="dt">color =</span> Category)) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-8" title="8"><span class="st">  </span><span class="co">#geom_point() +</span></a>
<a class="sourceLine" id="cb18-9" title="9"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">linetype =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-10" title="10"><span class="st">  </span><span class="co"># geom_smooth(size = 1, aes(fill = Category), show.legend = FALSE) +</span></a>
<a class="sourceLine" id="cb18-11" title="11"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb18-12" title="12"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> cat_colors22[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">13</span>,<span class="dv">11</span>,<span class="dv">20</span>,<span class="dv">5</span>,<span class="dv">18</span>)],</a>
<a class="sourceLine" id="cb18-13" title="13">                     <span class="dt">name=</span><span class="st">&quot;Threat Category&quot;</span>,</a>
<a class="sourceLine" id="cb18-14" title="14">                     <span class="dt">labels=</span>u.threat_list) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-15" title="15"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> cat_colors7) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-16" title="16"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Year&quot;</span>, </a>
<a class="sourceLine" id="cb18-17" title="17">       <span class="dt">y=</span><span class="st">&quot;Money ($US Million)&quot;</span>, </a>
<a class="sourceLine" id="cb18-18" title="18">       <span class="dt">title=</span><span class="st">&quot;Amount of Money Allocated Across Unique Threat Categories per Year&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-19" title="19"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="co">#labels = waiver(),</span></a>
<a class="sourceLine" id="cb18-20" title="20">                     <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">50e6</span>,<span class="fl">10e7</span>),</a>
<a class="sourceLine" id="cb18-21" title="21">                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;0&quot;</span>,<span class="st">&quot;50&quot;</span>,<span class="st">&quot;100&quot;</span>),</a>
<a class="sourceLine" id="cb18-22" title="22">                     <span class="dt">position =</span> <span class="st">&quot;right&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-23" title="23"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">14</span>),</a>
<a class="sourceLine" id="cb18-24" title="24">        <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">16</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>),</a>
<a class="sourceLine" id="cb18-25" title="25">        <span class="dt">legend.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">14</span>),</a>
<a class="sourceLine" id="cb18-26" title="26">        <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>),</a>
<a class="sourceLine" id="cb18-27" title="27">        <span class="dt">legend.key.width =</span> <span class="kw">unit</span>(<span class="dv">1</span>,<span class="st">&quot;cm&quot;</span>),</a>
<a class="sourceLine" id="cb18-28" title="28">        <span class="co"># legend.box.spacing = unit(1,&quot;cm&quot;),</span></a>
<a class="sourceLine" id="cb18-29" title="29">        <span class="dt">legend.spacing.x =</span> <span class="kw">unit</span>(<span class="dv">1</span>,<span class="st">&quot;cm&quot;</span>),</a>
<a class="sourceLine" id="cb18-30" title="30">        <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</a>
<a class="sourceLine" id="cb18-31" title="31">        <span class="co"># legend.background = element_rect(color = &quot;black&quot;, size = 1.2, fill = NA))</span></a>
<a class="sourceLine" id="cb18-32" title="32"></a>
<a class="sourceLine" id="cb18-33" title="33"><span class="co"># ggsave(threat_temporal.plot, filename = &quot;~/Columbia E3B/Conservation Group/Output V15.2/Figures/threat_temporal.png&quot;, width=12, height=7,dpi = 300)</span></a>
<a class="sourceLine" id="cb18-34" title="34"></a>
<a class="sourceLine" id="cb18-35" title="35"></a>
<a class="sourceLine" id="cb18-36" title="36">threat_temporal.plot</a></code></pre></div>
<p>Add a new chunk by clicking the <em>Insert Chunk</em> button on the toolbar or by pressing <em>Ctrl+Alt+I</em>.</p>
<p>When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the <em>Preview</em> button or press <em>Ctrl+Shift+K</em> to preview the HTML file).</p>
<p>The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike <em>Knit</em>, <em>Preview</em> does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.</p>

</div>
<div id="figure-3-taxathreat-maxwell-comparison" class="section level3">
<h3><span class="header-section-number">1.5.3</span> Figure 3: Taxa/Threat Maxwell Comparison</h3>
<p><strong>INSERT FIGURE CAPTION FROM MANUSCRIPT</strong>
#### Coercing Maxwell’s species designations to merge with ours
We are merging the various taxa catgories used by Maxwell et al. to examine the amount of funding disbursed to various taxa. Maxwell et al.’s taxonic designations are at a higher resolution than the what we need, so we are altering them to fit the taxonomic scale we’re operating at.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">maxwell.s4 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;~/Columbia E3B/Conservation Group/Maxwell et al table S4.csv&quot;</span>)</a>
<a class="sourceLine" id="cb19-2" title="2"><span class="kw">names</span>(maxwell.s4)</a>
<a class="sourceLine" id="cb19-3" title="3"></a>
<a class="sourceLine" id="cb19-4" title="4"><span class="co"># Our species: Amphibians, Birds, Fish, Invertebrates, Mammals, Plants, Reptiles</span></a>
<a class="sourceLine" id="cb19-5" title="5"></a>
<a class="sourceLine" id="cb19-6" title="6">our.species &lt;-<span class="st"> </span>maxwell.s4 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-7" title="7"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-8" title="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Amphibians =</span> Amphibia,</a>
<a class="sourceLine" id="cb19-9" title="9">         <span class="dt">Birds =</span> Aves,</a>
<a class="sourceLine" id="cb19-10" title="10">         <span class="dt">Fish =</span> Actinopterygii <span class="op">+</span><span class="st"> </span>Chondrichthyes,</a>
<a class="sourceLine" id="cb19-11" title="11">         <span class="dt">Invertebrates =</span> Anthozoa <span class="op">+</span><span class="st"> </span>Gastropoda <span class="op">+</span><span class="st"> </span>Hydrozoa <span class="op">+</span><span class="st"> </span>Malacostraca <span class="op">+</span><span class="st"> </span>Myxini,</a>
<a class="sourceLine" id="cb19-12" title="12">         <span class="dt">Mammals =</span> Mammalia,</a>
<a class="sourceLine" id="cb19-13" title="13">         <span class="dt">Plants =</span> Cycadopsida <span class="op">+</span><span class="st"> </span>Liliopsida <span class="op">+</span><span class="st"> </span>Magnoliopsida <span class="op">+</span><span class="st"> </span>Pinopsida,</a>
<a class="sourceLine" id="cb19-14" title="14">         <span class="dt">Reptiles =</span> Reptilia) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-15" title="15"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>, <span class="dv">19</span><span class="op">:</span><span class="kw">ncol</span>(.), <span class="dv">18</span>))</a>
<a class="sourceLine" id="cb19-16" title="16">our.species</a></code></pre></div>
<div id="figure-3" class="section level4">
<h4><span class="header-section-number">1.5.3.1</span> Figure 3</h4>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="co"># Preparing maxwell data</span></a>
<a class="sourceLine" id="cb20-2" title="2">fig.<span class="fl">3.</span>maxwell_data &lt;-<span class="st"> </span>our.species <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-3" title="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">11</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(Category) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-5" title="5"><span class="st">  </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(Total<span class="op">:</span>Reptiles), sum) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-6" title="6"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="dv">3</span><span class="op">:</span><span class="kw">length</span>(.)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-7" title="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Total.maxwell =</span> <span class="kw">rowSums</span>(.)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-8" title="8"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="dv">8</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-9" title="9"><span class="st">  </span><span class="kw">transmute_at</span>(<span class="kw">vars</span>(<span class="op">-</span>Total.maxwell), <span class="op">~</span><span class="st"> </span>(.<span class="op">/</span>Total.maxwell)<span class="op">*</span><span class="dv">100</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-10" title="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Threat =</span> u.threat_list) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-11" title="11"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="dv">8</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-12" title="12"><span class="st">  </span><span class="kw">pivot_longer</span>(Amphibians<span class="op">:</span>Reptiles, <span class="dt">names_to =</span> <span class="st">&quot;Taxa&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;Percent&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-13" title="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Source =</span> <span class="st">&quot;IUCN&quot;</span>, <span class="dt">direction =</span> <span class="dv">-1</span>, <span class="dt">alpha =</span> <span class="fl">0.9</span>)</a>
<a class="sourceLine" id="cb20-14" title="14"></a>
<a class="sourceLine" id="cb20-15" title="15"></a>
<a class="sourceLine" id="cb20-16" title="16"><span class="co"># Preparing money data</span></a>
<a class="sourceLine" id="cb20-17" title="17">taxa_climate &lt;-<span class="st"> </span>money.data_bio <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-18" title="18"><span class="st">  </span><span class="kw">filter</span>(cat_threat_climate <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-19" title="19"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(cat_taxa_amphibian<span class="op">:</span>cat_taxa_reptile) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-20" title="20"><span class="st">  </span><span class="kw">pivot_longer</span>(cat_taxa_amphibian<span class="op">:</span>cat_taxa_reptile, </a>
<a class="sourceLine" id="cb20-21" title="21">               <span class="dt">names_to =</span> <span class="st">&quot;Category&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;Money&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-22" title="22"><span class="st">  </span><span class="kw">group_by</span>(Category) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-23" title="23"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">totalAmount =</span> <span class="kw">sum</span>(Money)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-24" title="24"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">perc =</span> totalAmount<span class="op">/</span><span class="kw">sum</span>(totalAmount)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-25" title="25"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(perc) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-26" title="26"><span class="st">  </span><span class="kw">t</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-27" title="27"><span class="st">  </span><span class="kw">as.data.frame</span>(<span class="dt">row.names =</span> <span class="st">&quot;cat_threat_climate&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-28" title="28"><span class="st">  `</span><span class="dt">colnames&lt;-</span><span class="st">`</span> (u.taxa_list)</a>
<a class="sourceLine" id="cb20-29" title="29"></a>
<a class="sourceLine" id="cb20-30" title="30">taxa_energy &lt;-<span class="st"> </span>money.data_bio <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-31" title="31"><span class="st">  </span><span class="kw">filter</span>(cat_threat_energytransport <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-32" title="32"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(cat_taxa_amphibian<span class="op">:</span>cat_taxa_reptile) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-33" title="33"><span class="st">  </span><span class="kw">pivot_longer</span>(cat_taxa_amphibian<span class="op">:</span>cat_taxa_reptile, </a>
<a class="sourceLine" id="cb20-34" title="34">               <span class="dt">names_to =</span> <span class="st">&quot;Category&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;Money&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-35" title="35"><span class="st">  </span><span class="kw">group_by</span>(Category) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-36" title="36"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">totalAmount =</span> <span class="kw">sum</span>(Money)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-37" title="37"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">perc =</span> totalAmount<span class="op">/</span><span class="kw">sum</span>(totalAmount)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-38" title="38"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(perc) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-39" title="39"><span class="st">  </span><span class="kw">t</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-40" title="40"><span class="st">  </span><span class="kw">as.data.frame</span>(<span class="dt">row.names =</span> <span class="st">&quot;cat_threat_energytransport&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-41" title="41"><span class="st">  `</span><span class="dt">colnames&lt;-</span><span class="st">`</span> (u.taxa_list)</a>
<a class="sourceLine" id="cb20-42" title="42"></a>
<a class="sourceLine" id="cb20-43" title="43">taxa_habitat &lt;-<span class="st"> </span>money.data_bio <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-44" title="44"><span class="st">  </span><span class="kw">filter</span>(cat_threat_habitat <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-45" title="45"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(cat_taxa_amphibian<span class="op">:</span>cat_taxa_reptile) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-46" title="46"><span class="st">  </span><span class="kw">pivot_longer</span>(cat_taxa_amphibian<span class="op">:</span>cat_taxa_reptile, </a>
<a class="sourceLine" id="cb20-47" title="47">               <span class="dt">names_to =</span> <span class="st">&quot;Category&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;Money&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-48" title="48"><span class="st">  </span><span class="kw">group_by</span>(Category) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-49" title="49"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">totalAmount =</span> <span class="kw">sum</span>(Money)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-50" title="50"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">perc =</span> totalAmount<span class="op">/</span><span class="kw">sum</span>(totalAmount)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-51" title="51"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(perc) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-52" title="52"><span class="st">  </span><span class="kw">t</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-53" title="53"><span class="st">  </span><span class="kw">as.data.frame</span>(<span class="dt">row.names =</span> <span class="st">&quot;cat_threat_habitat&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-54" title="54"><span class="st">  `</span><span class="dt">colnames&lt;-</span><span class="st">`</span> (u.taxa_list)</a>
<a class="sourceLine" id="cb20-55" title="55"></a>
<a class="sourceLine" id="cb20-56" title="56">taxa_inv &lt;-<span class="st"> </span>money.data_bio <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-57" title="57"><span class="st">  </span><span class="kw">filter</span>(cat_threat_inv_spec <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-58" title="58"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(cat_taxa_amphibian<span class="op">:</span>cat_taxa_reptile) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-59" title="59"><span class="st">  </span><span class="kw">pivot_longer</span>(cat_taxa_amphibian<span class="op">:</span>cat_taxa_reptile, </a>
<a class="sourceLine" id="cb20-60" title="60">               <span class="dt">names_to =</span> <span class="st">&quot;Category&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;Money&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-61" title="61"><span class="st">  </span><span class="kw">group_by</span>(Category) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-62" title="62"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">totalAmount =</span> <span class="kw">sum</span>(Money)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-63" title="63"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">perc =</span> totalAmount<span class="op">/</span><span class="kw">sum</span>(totalAmount)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-64" title="64"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(perc) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-65" title="65"><span class="st">  </span><span class="kw">t</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-66" title="66"><span class="st">  </span><span class="kw">as.data.frame</span>(<span class="dt">row.names =</span> <span class="st">&quot;cat_threat_inv_spec&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-67" title="67"><span class="st">  `</span><span class="dt">colnames&lt;-</span><span class="st">`</span> (u.taxa_list)</a>
<a class="sourceLine" id="cb20-68" title="68"></a>
<a class="sourceLine" id="cb20-69" title="69">taxa_overexp &lt;-<span class="st"> </span>money.data_bio <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-70" title="70"><span class="st">  </span><span class="kw">filter</span>(cat_threat_overexp <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-71" title="71"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(cat_taxa_amphibian<span class="op">:</span>cat_taxa_reptile) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-72" title="72"><span class="st">  </span><span class="kw">pivot_longer</span>(cat_taxa_amphibian<span class="op">:</span>cat_taxa_reptile, </a>
<a class="sourceLine" id="cb20-73" title="73">               <span class="dt">names_to =</span> <span class="st">&quot;Category&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;Money&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-74" title="74"><span class="st">  </span><span class="kw">group_by</span>(Category) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-75" title="75"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">totalAmount =</span> <span class="kw">sum</span>(Money)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-76" title="76"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">perc =</span> totalAmount<span class="op">/</span><span class="kw">sum</span>(totalAmount)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-77" title="77"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(perc) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-78" title="78"><span class="st">  </span><span class="kw">t</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-79" title="79"><span class="st">  </span><span class="kw">as.data.frame</span>(<span class="dt">row.names =</span> <span class="st">&quot;cat_threat_overexp&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-80" title="80"><span class="st">  `</span><span class="dt">colnames&lt;-</span><span class="st">`</span> (u.taxa_list)</a>
<a class="sourceLine" id="cb20-81" title="81"></a>
<a class="sourceLine" id="cb20-82" title="82">taxa_pollution &lt;-<span class="st"> </span>money.data_bio <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-83" title="83"><span class="st">  </span><span class="kw">filter</span>(cat_threat_pollution <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-84" title="84"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(cat_taxa_amphibian<span class="op">:</span>cat_taxa_reptile) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-85" title="85"><span class="st">  </span><span class="kw">pivot_longer</span>(cat_taxa_amphibian<span class="op">:</span>cat_taxa_reptile, </a>
<a class="sourceLine" id="cb20-86" title="86">               <span class="dt">names_to =</span> <span class="st">&quot;Category&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;Money&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-87" title="87"><span class="st">  </span><span class="kw">group_by</span>(Category) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-88" title="88"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">totalAmount =</span> <span class="kw">sum</span>(Money)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-89" title="89"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">perc =</span> totalAmount<span class="op">/</span><span class="kw">sum</span>(totalAmount)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-90" title="90"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(perc) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-91" title="91"><span class="st">  </span><span class="kw">t</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-92" title="92"><span class="st">  </span><span class="kw">as.data.frame</span>(<span class="dt">row.names =</span> <span class="st">&quot;cat_threat_pollution&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-93" title="93"><span class="st">  `</span><span class="dt">colnames&lt;-</span><span class="st">`</span> (u.taxa_list)</a>
<a class="sourceLine" id="cb20-94" title="94"></a>
<a class="sourceLine" id="cb20-95" title="95">fig.<span class="fl">3.</span>money_data &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(taxa_climate, taxa_energy, taxa_habitat, </a>
<a class="sourceLine" id="cb20-96" title="96">                         taxa_inv, taxa_overexp, taxa_pollution) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-97" title="97"><span class="st">  </span><span class="kw">transmute_all</span>(<span class="op">~</span>.<span class="op">*</span><span class="dv">100</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-98" title="98"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Threat =</span> u.threat_list) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-99" title="99"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="dv">8</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-100" title="100"><span class="st">  </span><span class="kw">pivot_longer</span>(Amphibians<span class="op">:</span>Reptiles, <span class="dt">names_to =</span> <span class="st">&quot;Taxa&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;Percent&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-101" title="101"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Source =</span> <span class="st">&quot;Money&quot;</span>, <span class="dt">direction =</span> <span class="dv">1</span>, <span class="dt">alpha =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb20-102" title="102"></a>
<a class="sourceLine" id="cb20-103" title="103"><span class="co">### 1 plot</span></a>
<a class="sourceLine" id="cb20-104" title="104">fig.<span class="fl">3.</span>data &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(fig.<span class="fl">3.</span>money_data, fig.<span class="fl">3.</span>maxwell_data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-105" title="105"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Percent =</span> Percent <span class="op">*</span><span class="st"> </span>direction,</a>
<a class="sourceLine" id="cb20-106" title="106">         <span class="dt">Taxa =</span> <span class="kw">factor</span>(Taxa, </a>
<a class="sourceLine" id="cb20-107" title="107">                       <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Reptiles&quot;</span>, <span class="st">&quot;Amphibians&quot;</span>, <span class="st">&quot;Invertebrates&quot;</span>, </a>
<a class="sourceLine" id="cb20-108" title="108">                                  <span class="st">&quot;Birds&quot;</span>, <span class="st">&quot;Mammals&quot;</span>, <span class="st">&quot;Fish&quot;</span>, <span class="st">&quot;Plants&quot;</span>),</a>
<a class="sourceLine" id="cb20-109" title="109">                       <span class="dt">ordered =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb20-110" title="110">         <span class="dt">Threat =</span> <span class="kw">factor</span>(Threat,</a>
<a class="sourceLine" id="cb20-111" title="111">                         <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Climate Change&quot;</span>, <span class="st">&quot;Overexploitation&quot;</span>,</a>
<a class="sourceLine" id="cb20-112" title="112">                                    <span class="st">&quot;Habitat Loss&quot;</span>, <span class="st">&quot;Energy &amp; Transportation&quot;</span>,</a>
<a class="sourceLine" id="cb20-113" title="113">                                    <span class="st">&quot;Pollution&quot;</span>, <span class="st">&quot;Invasive Species&quot;</span>),</a>
<a class="sourceLine" id="cb20-114" title="114">                         <span class="dt">ordered =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb20-115" title="115">  )</a>
<a class="sourceLine" id="cb20-116" title="116"></a>
<a class="sourceLine" id="cb20-117" title="117">fig<span class="fl">.3</span> &lt;-<span class="st"> </span><span class="kw">ggplot</span>(fig.<span class="fl">3.</span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Taxa <span class="op">!=</span><span class="st"> &quot;Reptiles&quot;</span>),</a>
<a class="sourceLine" id="cb20-118" title="118">                <span class="kw">aes</span>(<span class="dt">x =</span> Taxa, <span class="dt">y =</span> Percent, <span class="dt">fill =</span> Taxa)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-119" title="119"><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">show.legend =</span> F , <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-120" title="120"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">size =</span> <span class="fl">1.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-121" title="121"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> cat_colors22[<span class="kw">c</span>(<span class="dv">9</span>,<span class="dv">20</span>,<span class="dv">19</span>,<span class="dv">15</span>,<span class="dv">7</span>,<span class="dv">11</span>)],</a>
<a class="sourceLine" id="cb20-122" title="122">                    <span class="dt">name =</span> <span class="st">&quot;Taxa&quot;</span>,</a>
<a class="sourceLine" id="cb20-123" title="123">                    <span class="dt">labels =</span> u.taxa_list) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-124" title="124"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Threat) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-125" title="125"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb20-126" title="126"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.y=</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb20-127" title="127">        <span class="co"># axis.text.y = element_text(size = 10, face = &quot;bold&quot;),</span></a>
<a class="sourceLine" id="cb20-128" title="128">        <span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb20-129" title="129">        <span class="co"># axis.text.y = element_text(size = 12),</span></a>
<a class="sourceLine" id="cb20-130" title="130">        <span class="co"># axis.title = element_text(size = 16, face = &quot;bold&quot;),</span></a>
<a class="sourceLine" id="cb20-131" title="131">        <span class="dt">axis.ticks.x=</span><span class="kw">element_line</span>(<span class="dt">color=</span><span class="ot">NA</span>),</a>
<a class="sourceLine" id="cb20-132" title="132">        <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;black&quot;</span>),</a>
<a class="sourceLine" id="cb20-133" title="133">        <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-134" title="134"><span class="st">  </span><span class="kw">ylim</span>(<span class="op">-</span><span class="dv">90</span>,<span class="dv">90</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-135" title="135"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Percent of Taxa Threatened (IUCN) by vs. Funded for Unique Threats&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-136" title="136"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;% Taxa Threatened   |    % Funding to Taxa&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-137" title="137"><span class="st">  </span><span class="kw">coord_flip</span>()</a>
<a class="sourceLine" id="cb20-138" title="138"></a>
<a class="sourceLine" id="cb20-139" title="139"><span class="co"># ggsave(fig.3, filename = &quot;~/Columbia E3B/Conservation Group/Output V15.2/Figures/taxa_threat_comparison.png&quot;, width=12, height=7,dpi = 300)</span></a>
<a class="sourceLine" id="cb20-140" title="140"></a>
<a class="sourceLine" id="cb20-141" title="141">fig<span class="fl">.3</span></a></code></pre></div>

</div>
</div>
<div id="figure-4-network-analysis" class="section level3">
<h3><span class="header-section-number">1.5.4</span> Figure 4: Network Analysis</h3>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>

<a href="figure-4-threats-network-analysis.html" class="navigation navigation-next navigation-unique" aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/vjjan91/conservation-spending/edit/master/index.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
